<!DOCTYPE html>
<html>

<head>
    <title>Google Maps Example</title>
    <link rel="icon" type="image/x-icon" href="img\favicon.ico">
    <link rel="stylesheet" type="text/css" href="./bikecss.css" />
</head>

<body>

    <header>
        <nav>
            <div class="logo1">
                <a href="ronan_dbbikes_updated.html"><img src="img\logo.png.png" alt="logo1" /></a>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Search...">
            </div>
            <ul>
                <li><a href="ronan_dbbikes_updated.html">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
            <div class="logo2">
                <a href="https://www.dublincity.ie/residential" target="_blank"><img src="img\logo-contractor.png" alt="logo2" /></a>
            </div>
            <div class="info-card">
                <h2 class="card-title">Station Info</h2>
                <div class="card-content">Select a station on the map to view its information.</div>
            </div>
        </nav>
    </header>
    <!-- Map container -->
    <div id="map"></div>
    <!-- Google Maps API script -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFKfX9-Zt_A2qvrIUyINuK2Gi-iOBHB5Y"></script>
    <!-- JavaScript code to create the map -->
    <script>
        // Call the initMap function when the page loads
        window.onload = initMap;

        function initMap() {
            // Set the map options
            var mapOptions = {
                zoom: 13.5, // Set the zoom level
                center: {
                    lat: 53.346396,
                    lng: -6.263156
                } // Set the center point of the map
            };
            // Create the map object
            var map = new google.maps.Map(document.getElementById('map'), mapOptions);

            // Create a variable to keep track of the currently open info window
            var openInfoWindow = null;

            // Define the custom icon
            var customIcon = {
                url: 'img/availablebikespng.png',
                scaledSize: new google.maps.Size(40, 40)
            };

            fetch('https://api.jcdecaux.com/vls/v1/stations?contract=Dublin&apiKey=a572dc37b128fb280c9e1621093640367863e160').then(response => response.json()).then(data => {
                // Loop through each station and add a marker to the map
                data.forEach(station => {
                    var marker = new google.maps.Marker({
                        position: {
                            lat: station.position.lat,
                            lng: station.position.lng
                        },
                        map: map,
                        icon: customIcon,
                        title: station.name
                    });

                    var infoWindow = new google.maps.InfoWindow({
                        content: '<div class="card">' +
                            '<div class="card-title">' + station.name + '</div>' +
                            '<div class="card-content">' +
                            '<p><img src="img/availablebikespng.png" width="40px" height="40px"> Available bikes: ' + station.available_bikes + '</p>' +
                            '<p><img src="img/bikestandspng.png" width="40px" height="40px"> Available bike stands: ' + station.available_bike_stands + '</p>' +
                            '</div>' +
                            '</div>'
                    });

                    // Add a click event listener to the marker
                    marker.addListener('click', function() {
                        // If an info window is already open, close it
                        if (openInfoWindow != null) {
                            openInfoWindow.close();
                        }

                        // Update the content of the info-card div
                        var infoCard = document.querySelector('.info-card');
                        infoCard.querySelector('.card-title').textContent = station.name;
                        infoCard.querySelector('.card-content').innerHTML = '<p><img src="img/availablebikespng.png" width="40px" height="40px"> Available bikes: ' + station.available_bikes + '</p>' +
                            '<p><img src="img/bikestandspng.png" width="40px" height="40px"> Available bike stands: ' + station.available_bike_stands + '</p>';

                        // Open the info window for the clicked marker and set it as the currently open info window
                        infoWindow.open(map, marker);
                        openInfoWindow = infoWindow;
                    });

                });
            });
        }

    </script>
</body>

</html>
